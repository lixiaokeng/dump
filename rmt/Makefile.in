top_srcdir=	@top_srcdir@
srcdir=		@srcdir@
top_builddir=	..

@MCONFIG@

ALL_CFLAGS=	@CPPFLAGS@ @CFLAGS@ @CCOPTS@ -pipe $(OPT) $(GINC) $(INC) $(DEFS)
LDFLAGS=	@LDFLAGS@
LIBS=		$(GLIBS)
DEPLIBS=	../compat/lib/libcompat.a

PROG=		rmt
SRCS=		rmt.c
OBJS=		rmt.o
MAN8=		rmt.8

.c.o:
	$(CC) -c $(ALL_CFLAGS) $< -o $@

all::		$(PROG) @ERMT@ $(MAN8)

$(PROG):	$(OBJS) $(DEPLIBS)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(LIBS)

ermt:	ermt.o cipher.o $(DEPLIBS)
	$(LD) $(LDFLAGS) -o ermt ermt.o cipher.o $(LIBS)

ermt.o: rmt.c
	$(CC) -c $(ALL_CFLAGS) -DERMT -o ermt.o rmt.c

$(MAN8):		rmt.8.in
	sed -e "s|__DATE__|$(DATE)|g" \
	    -e "s|__VERSION__|$(VERSION)|g" $< > $@

install::	all
	$(INSTALL) -d $(SBINDIR) $(MANDIR)
	$(INSTALLBIN) $(PROG) $(SBINDIR)
	$(INSTALLMAN) $(srcdir)/$(MAN8) $(MANDIR)

clean::
	rm -f $(PROG) @ERMT@ \#* *.s *.o *.a *~ core rmt.8

distclean::	clean
	rm -f Makefile Makefile.old .depend 

# +++ Dependency line eater +++
# 
# Makefile dependencies follow.  This must be the last section in
# the Makefile.in file
#

