top_srcdir=	@top_srcdir@
srcdir=		@srcdir@
top_builddir=	..

@MCONFIG@

INC=		-I$(top_srcdir)/dump -I$(top_srcdir)/common
ALL_CFLAGS=	@CPPFLAGS@ @CFLAGS@ @CCOPTS@ -pipe $(OPT) $(GINC) $(INC) $(DEFS) @DUMPDEBUG@ 
ALL_LDFLAGS=	@LDFLAGS@ @STATIC@
LIBS=		$(GLIBS) @ZLIB@ @BZLIB@ @BLKID@ @SQLITE3@
DEPLIBS=	../compat/lib/libcompat.a

PROG=		dump
RPROG=		rdump
LINKS=		${SBINDIR}/dump ${SBINDIR}/rdump
SRCS=		itime.c main.c optr.c tape.c traverse.c unctime.c
OBJS=		itime.o main.o optr.o tape.o traverse.o unctime.o \
		../common/dumprmt.o ../common/transformation_null.o ../common/transformation_lzo.o \
		../common/transformation_zlib.o ../common/transformation_bzlib.o \
		../common/legacy_indexer.o ../common/sqlite.o
MAN8=		dump.8
RMAN8=		rdump.8

.c.o:
	$(CC) -c $(ALL_CFLAGS) $< -o $@

all::		$(PROG) $(MAN8)

$(PROG):	$(OBJS) $(DEPLIBS)
	$(LD) $(ALL_LDFLAGS) -o $(PROG) $(OBJS) $(LIBS)

$(MAN8):	dump.8.in
	sed -e "s|__DUMPDATES__|$(DUMPDATESPATH)|g" \
	    -e "s|__DATE__|$(DATE)|g" \
	    -e "s|__VERSION__|$(VERSION)|g" $< > $@

install::	all
	$(INSTALL) -d $(SBINDIR) $(MANDIR)
	$(INSTALLBIN) $(PROG) $(SBINDIR)
	$(INSTALLMAN) $(MAN8) $(MANDIR)
	cd $(SBINDIR) && $(RM) -f $(RPROG) && $(LN_S) $(PROG) $(RPROG)
	cd $(MANDIR) && $(RM) -f $(RMAN8) && $(LN_S) $(MAN8) $(RMAN8)

clean::
	$(RM) -f $(PROG) $(MAN8) \#* *.s *.o *.a *~ core

distclean::	clean
	$(RM) -f Makefile Makefile.old .depend

# +++ Dependency line eater +++
# 
# Makefile dependencies follow.  This must be the last section in
# the Makefile.in file
#

